
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>src.classes &#8212; BioSNICAR 2.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/haiku.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../index.html">
          <span>BioSNICAR 2.0 documentation</span></a></h1>
        <h2 class="heading"><span>src.classes</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>
      <div class="content" role="main">
        
        
  <h1>Source code for src.classes</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os</span>


<div class="viewcode-block" id="Impurity"><a class="viewcode-back" href="../../src.html#src.classes.Impurity">[docs]</a><span class="k">class</span> <span class="nc">Impurity</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Light absorbing impurity.</span>

<span class="sd">    Instances of Impurity are one discrete type of light absorbing impurity with</span>
<span class="sd">    a distinct set of optical properties.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        name: name of impurity</span>
<span class="sd">        cfactor: concentration factor used to convert field measurements to model config (default=1)</span>
<span class="sd">        unit: the unit the concentration should be represented in (0 = ppb, 1 = cells/mL)</span>
<span class="sd">        conc: concentration of the impurity in each layer (in units of self.unit)</span>
<span class="sd">        file: name of netCDF file containing optical properties and size distribution</span>
<span class="sd">        impurity_properties: instance of opened file self.file</span>
<span class="sd">        mac: mass absorption coefficient (m2/kg or m2/cell)</span>
<span class="sd">        ssa: single scattering albedo</span>
<span class="sd">        g: asymmetry parameter</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">coated</span><span class="p">,</span> <span class="n">cfactor</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">conc</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfactor</span> <span class="o">=</span> <span class="n">cfactor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conc</span> <span class="o">=</span> <span class="n">conc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">file</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">impurity_properties</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;/Data/OP_data/480band/lap/&quot;</span> <span class="o">+</span> <span class="n">file</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">coated</span><span class="p">:</span>
            <span class="n">mac_stub</span> <span class="o">=</span> <span class="s2">&quot;ext_cff_mss_ncl&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mac_stub</span> <span class="o">=</span> <span class="s2">&quot;ext_cff_mss&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">impurity_properties</span><span class="p">[</span><span class="n">mac_stub</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">impurity_properties</span><span class="p">[</span><span class="s2">&quot;ss_alb&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">impurity_properties</span><span class="p">[</span><span class="s2">&quot;asm_prm&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mac</span><span class="p">)</span> <span class="o">==</span> <span class="mi">480</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ssa</span><span class="p">)</span> <span class="o">==</span> <span class="mi">480</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">)</span> <span class="o">==</span> <span class="mi">480</span></div>


<div class="viewcode-block" id="Ice"><a class="viewcode-back" href="../../src.html#src.classes.Ice">[docs]</a><span class="k">class</span> <span class="nc">Ice</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Snow or ice column physical properties.</span>

<span class="sd">    Instances of Ice contain all the physical properties of each vertical layer of the</span>
<span class="sd">    snow or ice column and the underlying surface.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        dz: array containing thickness of each layer in m</span>
<span class="sd">        layer_type: array containing type (0 = grains, 1 = solid ice) in each layer</span>
<span class="sd">        cdom: array containing Boolean (1/0) toggling presence of cdom in each layer</span>
<span class="sd">        rho: array containing density of each layer in kg/m3</span>
<span class="sd">        sfc: array with reflectance of underlying surface per wavelength</span>
<span class="sd">        rf: refractive index to use, 0,1,2 or 3 (see docs for definition)</span>
<span class="sd">        shp: grain shape per layer where layer_type==1</span>
<span class="sd">        rds: grain radius (layer_type==0) or bubble radius (layer_type==0) in each layer</span>
<span class="sd">        water: radius of grain+water coating in each layer where layer_type==0</span>
<span class="sd">        hex_side: length of each side of hexagonal face for grain_shp==4</span>
<span class="sd">        hex_length: column length for hexagonal face for grain_shp==4</span>
<span class="sd">        shp_fctr: ratio of nonspherical eff radii to equal vol sphere, in each layer</span>
<span class="sd">        ar: aspect ratio of grains in each layer where layer_type==0</span>
<span class="sd">        nbr_lyr: number of vertical layers</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># use config to calculate refractive indices</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./src/inputs.yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ymlfile</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ymlfile</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dz</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;ICE&quot;</span><span class="p">][</span><span class="s2">&quot;DZ&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer_type</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;ICE&quot;</span><span class="p">][</span><span class="s2">&quot;LAYER_TYPE&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cdom</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;ICE&quot;</span><span class="p">][</span><span class="s2">&quot;CDOM&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;ICE&quot;</span><span class="p">][</span><span class="s2">&quot;RHO&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sfc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;SFC&quot;</span><span class="p">],</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;csv&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rf</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;ICE&quot;</span><span class="p">][</span><span class="s2">&quot;RF&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shp</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;ICE&quot;</span><span class="p">][</span><span class="s2">&quot;SHP&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rds</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;ICE&quot;</span><span class="p">][</span><span class="s2">&quot;RDS&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">water</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;ICE&quot;</span><span class="p">][</span><span class="s2">&quot;WATER&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hex_side</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;ICE&quot;</span><span class="p">][</span><span class="s2">&quot;HEX_SIDE&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hex_length</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;ICE&quot;</span><span class="p">][</span><span class="s2">&quot;HEX_LENGTH&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shp_fctr</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;ICE&quot;</span><span class="p">][</span><span class="s2">&quot;SHP_FCTR&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ar</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;ICE&quot;</span><span class="p">][</span><span class="s2">&quot;AR&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbr_lyr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dz</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_refractive_index</span><span class="p">()</span>

<div class="viewcode-block" id="Ice.calculate_refractive_index"><a class="viewcode-back" href="../../src.html#src.classes.Ice.calculate_refractive_index">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_refractive_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates ice refractive index from initialized class attributes.</span>

<span class="sd">        Takes self.rf and config from inpouts.yaml and uses them to calculate</span>
<span class="sd">        new attributes related to the ice refractive index.</span>

<span class="sd">        Args:</span>
<span class="sd">            self</span>

<span class="sd">        Returns:</span>
<span class="sd">            ref_idx_im: imaginary part of refractive index</span>
<span class="sd">            ref_idx_re: real part of refractive index</span>
<span class="sd">            fl_r_dif_a: precomputed diffuse reflectance &quot;perpendicular polarized)</span>
<span class="sd">            fl_r_dif_b: precomputed diffuse reflectance &quot;parallel polarized)</span>
<span class="sd">            op_dir: directory containing optical properties</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError if rf out of range</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rf</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rf</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Ice ref index type out of range - between 0 and 2 only&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./src/inputs.yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ymlfile</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ymlfile</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>

        <span class="n">refidx_file</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;RI_ICE&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;rfidx_ice.nc&quot;</span><span class="p">)</span>
        <span class="n">fresnel_diffuse_file</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;RI_ICE&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;fl_reflection_diffuse.nc&quot;</span>
        <span class="p">)</span>

        <span class="n">rf</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;ICE&quot;</span><span class="p">][</span><span class="s2">&quot;RF&quot;</span><span class="p">]</span>
        <span class="n">op_dir_stub</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;OP_DIR_STUBS&quot;</span><span class="p">][</span><span class="n">rf</span><span class="p">]</span>
        <span class="n">ref_idx_name</span> <span class="o">=</span> <span class="n">op_dir_stub</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ref_idx_re</span> <span class="o">=</span> <span class="n">refidx_file</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;re_&quot;</span> <span class="o">+</span> <span class="n">ref_idx_name</span><span class="p">)]</span><span class="o">.</span><span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_idx_im</span> <span class="o">=</span> <span class="n">refidx_file</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;im_&quot;</span> <span class="o">+</span> <span class="n">ref_idx_name</span><span class="p">)]</span><span class="o">.</span><span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fl_r_dif_a</span> <span class="o">=</span> <span class="n">fresnel_diffuse_file</span><span class="p">[</span>
            <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;R_dif_fa_ice_&quot;</span> <span class="o">+</span> <span class="n">ref_idx_name</span><span class="p">)</span>
        <span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fl_r_dif_b</span> <span class="o">=</span> <span class="n">fresnel_diffuse_file</span><span class="p">[</span>
            <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;R_dif_fb_ice_&quot;</span> <span class="o">+</span> <span class="n">ref_idx_name</span><span class="p">)</span>
        <span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op_dir</span> <span class="o">=</span> <span class="n">op_dir_stub</span></div></div>


<div class="viewcode-block" id="Illumination"><a class="viewcode-back" href="../../src.html#src.classes.Illumination">[docs]</a><span class="k">class</span> <span class="nc">Illumination</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Properties of incoming irradiance.</span>

<span class="sd">    Instances of Illumination contain all data relating to the incoming irradiance.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        direct: Boolean toggling between direct and diffuse irradiance</span>
<span class="sd">        solzen: solar zenith angle in degrees from the vertical</span>
<span class="sd">        incoming: choice of spectral distribution from file 0-6</span>
<span class="sd">        flx_dir: directory containing irradiance files</span>
<span class="sd">        stubs: array of stub strings for selecting irradiance files</span>
<span class="sd">        nbr_wvl: number fo wavelengths (default 480)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./src/inputs.yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ymlfile</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ymlfile</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">direct</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;RTM&quot;</span><span class="p">][</span><span class="s2">&quot;DIRECT&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solzen</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;RTM&quot;</span><span class="p">][</span><span class="s2">&quot;SOLZEN&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incoming</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;RTM&quot;</span><span class="p">][</span><span class="s2">&quot;INCOMING&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flx_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;FLX_DIR&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stubs</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;RTM&quot;</span><span class="p">][</span><span class="s2">&quot;ILLUMINATION_FILE_STUBS&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbr_wvl</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;RTM&quot;</span><span class="p">][</span><span class="s2">&quot;NBR_WVL&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_irradiance</span><span class="p">()</span>

<div class="viewcode-block" id="Illumination.calculate_irradiance"><a class="viewcode-back" href="../../src.html#src.classes.Illumination.calculate_irradiance">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_irradiance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates irradiance from initialized attributes.</span>

<span class="sd">        Takes mu_not, incoming and file stubs from self and calculates irradiance.</span>

<span class="sd">        Args:</span>
<span class="sd">            self</span>

<span class="sd">        Returns:</span>
<span class="sd">            flx_slr: incoming flux from file</span>
<span class="sd">            Fd: diffuse irradiance</span>
<span class="sd">            Fs: direct irradiance</span>


<span class="sd">        Raises:</span>
<span class="sd">            ValueError is incoming is out of range</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incoming</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">incoming</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Irradiance type out of range - between 0 and 6 only&quot;</span><span class="p">)</span>

        <span class="c1"># update mu_not from solzen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mu_not</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solzen</span><span class="p">)))</span>

        <span class="c1"># calculate irradiance from file</span>
        <span class="n">cloud_stub</span> <span class="o">=</span> <span class="s2">&quot;_cld&quot;</span>
        <span class="n">coszen_stub</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direct</span><span class="p">:</span>
            <span class="n">cloud_stub</span> <span class="o">=</span> <span class="s2">&quot;_clr_&quot;</span>
            <span class="n">coszen_stub</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;SZA&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solzen</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">))</span>

        <span class="n">incoming_file</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flx_dir</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stubs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">incoming</span><span class="p">]</span>
                <span class="o">+</span> <span class="n">cloud_stub</span>
                <span class="o">+</span> <span class="n">coszen_stub</span>
                <span class="o">+</span> <span class="s2">&quot;.nc&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">flx_slr</span> <span class="o">=</span> <span class="n">incoming_file</span><span class="p">[</span><span class="s2">&quot;flx_frc_sfc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">flx_slr</span><span class="p">[</span><span class="n">flx_slr</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-30</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flx_slr</span> <span class="o">=</span> <span class="n">flx_slr</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">flx_slr</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu_not</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direct</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fs</span> <span class="o">=</span> <span class="n">out</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nbr_wvl</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fd</span> <span class="o">=</span> <span class="n">out</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nbr_wvl</span><span class="p">)</span>
        <span class="k">return</span>

        <span class="k">return</span></div></div>


<div class="viewcode-block" id="RTConfig"><a class="viewcode-back" href="../../src.html#src.classes.RTConfig">[docs]</a><span class="k">class</span> <span class="nc">RTConfig</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Radiative transfer configuration.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        aprx_type: choice of two-stream approximation (0-2)</span>
<span class="sd">        delta: Boolean to toggle delta transformation (0/1)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./src/inputs.yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ymlfile</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ymlfile</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">aprx_typ</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;RTM&quot;</span><span class="p">][</span><span class="s2">&quot;APRX_TYP&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;RTM&quot;</span><span class="p">][</span><span class="s2">&quot;DELTA&quot;</span><span class="p">]</span></div>


<div class="viewcode-block" id="ModelConfig"><a class="viewcode-back" href="../../src.html#src.classes.ModelConfig">[docs]</a><span class="k">class</span> <span class="nc">ModelConfig</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Model configuration.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        smooth: Boolean to toggle savitsky-golay filter to smooth albedo</span>
<span class="sd">        window_size: window size to use for smoothing func</span>
<span class="sd">        poly_order: order of polynomial used to smooth albedo</span>
<span class="sd">        dir_base: base directory</span>
<span class="sd">        dir_wvl: path to wavelengths in csv file</span>
<span class="sd">        sphere_ice_path: directory containing OPs for spherical ice grains</span>
<span class="sd">        hex_ice_path: directory containing OPs for hexagonal ice grains</span>
<span class="sd">        bubbly_ice_path: directory containing OPs for bubbly ice</span>
<span class="sd">        ri_ice_path: path to file containing pure ice refractive index</span>
<span class="sd">        op_dir_stubs: sstring stubs for ice optical property files</span>
<span class="sd">        wavelengths: array of wavelengths in nm (default 0.205 - 4.995 um)</span>
<span class="sd">        nbr_wvl: number of wavelengths (default 480)</span>
<span class="sd">        vis_max_idx: index for upper visible wavelength (default 0.75 um)</span>
<span class="sd">        nir_max_idx: index for upper NIR wavelength (default 4.995 um)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./src/inputs.yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ymlfile</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ymlfile</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">smooth</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;CTRL&quot;</span><span class="p">][</span><span class="s2">&quot;SMOOTH&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;CTRL&quot;</span><span class="p">][</span><span class="s2">&quot;WINDOW_SIZE&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poly_order</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;CTRL&quot;</span><span class="p">][</span><span class="s2">&quot;POLY_ORDER&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dir_base</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dir_wvl</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;WVL&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sphere_ice_path</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;SPHERE_ICE&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hex_ice_path</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;HEX_ICE&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bubbly_ice_path</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;BUBBLY_ICE&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ri_ice_path</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;RI_ICE&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op_dir_stubs</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;OP_DIR_STUBS&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.205</span><span class="p">,</span> <span class="mf">4.999</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbr_wvl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelengths</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vis_max_idx</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;RTM&quot;</span><span class="p">][</span><span class="s2">&quot;VIS_MAX_IDX&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nir_max_idx</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;RTM&quot;</span><span class="p">][</span><span class="s2">&quot;NIR_MAX_IDX&quot;</span><span class="p">]</span></div>


<div class="viewcode-block" id="Outputs"><a class="viewcode-back" href="../../src.html#src.classes.Outputs">[docs]</a><span class="k">class</span> <span class="nc">Outputs</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;output data from radiative transfer calculations.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        heat_rt: heating rate in each layer</span>
<span class="sd">        BBAVIS: broadband albedo in visible range</span>
<span class="sd">        BBANIR: broadband albedo in NIR range</span>
<span class="sd">        BBA: broadband albedo across solar spectrum</span>
<span class="sd">        abs_slr_btm: absorbed solar energy at bottom surface</span>
<span class="sd">        abs_vis_btm: absorbed visible energy at bottom surface</span>
<span class="sd">        abs_nir_btm: absorbed NIR energy at bottom surface</span>
<span class="sd">        albedo: albedo of ice column</span>
<span class="sd">        total_insolation: energy arriving from atmosphere</span>
<span class="sd">        abs_slr_tot: total absorbed energy across solar spectrum</span>
<span class="sd">        abs_vis_tot: total absorbed energy across visible spectrum</span>
<span class="sd">        abs_nir_tot: total absorbed energy across NIR spectrum</span>
<span class="sd">        absorbed_flux_per_layer: total absorbed flux per layer</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heat_rt</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BBAVIS</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BBANIR</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BBA</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abs_slr_btm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abs_vis_btm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abs_nir_btm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">albedo</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_insolation</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abs_slr_tot</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abs_vis_tot</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abs_nir_tot</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">absorbed_flux_per_layer</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="PlotConfig"><a class="viewcode-back" href="../../src.html#src.classes.PlotConfig">[docs]</a><span class="k">class</span> <span class="nc">PlotConfig</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Configuration for plotting figures.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        figsize: size of figure</span>
<span class="sd">        facecolor: colour of background</span>
<span class="sd">        grid: toggles grid visibility</span>
<span class="sd">        grid_color: color of grid lines</span>
<span class="sd">        xtick_width: frequency of xticks</span>
<span class="sd">        xtick_size: size of ticks on x axis</span>
<span class="sd">        ytick_width: frequency of yticks</span>
<span class="sd">        ytick_size: size of ticks on y axis</span>
<span class="sd">        linewidth: pixel width of line on plot</span>
<span class="sd">        fontsize: size of text labels</span>
<span class="sd">        xtick_btm: toggles tick positions</span>
<span class="sd">        ytick_left: toggle ytick position</span>
<span class="sd">        show: toggles showing plot on screen</span>
<span class="sd">        save: toggles saving figure to file</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./src/inputs.yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ymlfile</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ymlfile</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">figsize</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PLOT&quot;</span><span class="p">][</span><span class="s2">&quot;FIG_SIZE&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facecolor</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PLOT&quot;</span><span class="p">][</span><span class="s2">&quot;FACECOLOR&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PLOT&quot;</span><span class="p">][</span><span class="s2">&quot;GRID&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_color</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PLOT&quot;</span><span class="p">][</span><span class="s2">&quot;GRIDCOLOR&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xtick_width</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PLOT&quot;</span><span class="p">][</span><span class="s2">&quot;XTICK_WIDTH&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xtick_size</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PLOT&quot;</span><span class="p">][</span><span class="s2">&quot;XTICK_SIZE&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ytick_width</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PLOT&quot;</span><span class="p">][</span><span class="s2">&quot;YTICK_WIDTH&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ytick_size</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PLOT&quot;</span><span class="p">][</span><span class="s2">&quot;YTICK_SIZE&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PLOT&quot;</span><span class="p">][</span><span class="s2">&quot;LINEWIDTH&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PLOT&quot;</span><span class="p">][</span><span class="s2">&quot;FONTSIZE&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xtick_btm</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PLOT&quot;</span><span class="p">][</span><span class="s2">&quot;XTICK_BTM&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ytick_left</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PLOT&quot;</span><span class="p">][</span><span class="s2">&quot;YTICK_LEFT&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PLOT&quot;</span><span class="p">][</span><span class="s2">&quot;SAVE&quot;</span><span class="p">]</span></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Joseph Cook.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>